<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jurnal Relațional</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121b3a; --txt:#eef2ff; --muted:#b9c4ff;
      --border: rgba(255,255,255,.12);
    }
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--txt);}
    .wrap{max-width:980px;margin:0 auto;padding:24px;}
    h1{font-size:22px;margin:0 0 12px;}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;}
    @media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr;}}
    .card{background:rgba(18,27,58,.75);border:1px solid var(--border);border-radius:16px;padding:16px;}
    label{display:block;margin:12px 0 6px;color:var(--muted);font-size:13px;}
    select, textarea, input{width:100%;box-sizing:border-box;background:rgba(255,255,255,.06);color:var(--txt);
      border:1px solid var(--border);border-radius:12px;padding:10px;outline:none;}
    textarea{min-height:90px;resize:vertical;}
    button{cursor:pointer;border:none;border-radius:12px;padding:10px 14px;font-weight:600;background:#ff4fd8;color:#12051a;}
    button:active{transform:translateY(1px);}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;}
    .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid var(--border);font-size:12px;color:var(--muted);}
    .scoreBox{padding:14px;border-radius:16px;border:1px solid var(--border);}
    .scoreBig{font-size:34px;font-weight:800;margin:0;}
    .bar{height:12px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid var(--border);overflow:hidden;margin-top:10px;}
    .bar > div{height:100%;width:0%;}
    .list{margin:10px 0 0;padding:0;list-style:none;}
    .list li{padding:10px 0;border-top:1px solid var(--border);display:flex;justify-content:space-between;gap:10px;}
    .small{color:var(--muted);font-size:12px;}
    .danger{color:#ffb4b4;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Jurnal: Cum m-a făcut partenerul să mă simt azi</h1>
    <div class="grid">

      <!-- FORM -->
      <div class="card">
        <div class="row">
          <div class="pill">Scală 1 (deloc) → 5 (foarte mult)</div>
          <div class="pill">Datele se salvează local în browser</div>
        </div>

        <label>Data</label>
        <input id="date" type="date" />

        <label>1) M-am simțit respectat/ă</label>
        <select id="q1"></select>

        <label>2) M-am simțit ascultat/ă</label>
        <select id="q2"></select>

        <label>3) M-am simțit în siguranță emoțional</label>
        <select id="q3"></select>

        <label>4) Am simțit susținere / încurajare</label>
        <select id="q4"></select>

        <label>5) M-am simțit apropiat/ă (conexiune)</label>
        <select id="q5"></select>

        <label>6) M-am simțit criticat/ă sau invalidat/ă (întrebare inversă)</label>
        <select id="q6"></select>

        <label>Notițe (opțional)</label>
        <textarea id="notes" placeholder="Ce s-a întâmplat azi? Context, exemple, emoții..."></textarea>

        <div class="row" style="margin-top:14px;">
          <button id="saveBtn">Save day</button>
          <button id="clearBtn" style="background:rgba(255,255,255,.10);color:var(--txt);border:1px solid var(--border);">Clear all data</button>
        </div>

        <p class="small" id="msg" style="margin-top:10px;"></p>
      </div>

      <!-- DASHBOARD -->
      <div class="card">
        <div id="scoreBox" class="scoreBox">
          <div class="row">
            <div>
              <div class="small">Scor azi</div>
              <p class="scoreBig" id="scoreVal">—</p>
              <div class="small" id="scoreLabel">Completează formularul și salvează.</div>
            </div>
            <div class="pill" id="trendPill">—</div>
          </div>
          <div class="bar"><div id="barFill"></div></div>
        </div>

        <h3 style="margin:16px 0 8px;">Istoric</h3>
        <ul class="list" id="history"></ul>
        <p class="small">Tip: urmărește trendul pe 7–14 zile, nu o zi izolată.</p>
      </div>

    </div>
  </div>

<script>
  // ---------- Helpers ----------
  const $ = (id) => document.getElementById(id);

  function rangeOptions(selectEl){
    selectEl.innerHTML = "";
    for(let i=1;i<=5;i++){
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = i;
      selectEl.appendChild(opt);
    }
    selectEl.value = 3; // default neutral
  }

  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  // Gradient color based on score
  function scoreColor(score){
    // 0..100 -> red->yellow->green
    if(score < 40) return "#ff5d5d";
    if(score < 70) return "#ffd34d";
    return "#4dff8a";
  }

  function scoreLabel(score){
    if(score < 40) return "Zonă de alertă (roșu)";
    if(score < 70) return "Zonă instabilă (galben)";
    return "Zonă bună (verde)";
  }

  // ---------- Scoring ----------
  // q1..q5 positive (1..5), q6 negative (1..5 -> invert)
  function computeScore(entry){
    const pos = [entry.q1, entry.q2, entry.q3, entry.q4, entry.q5].map(Number);
    const neg = Number(entry.q6);

    // invert q6: 1->5, 5->1
    const q6inv = 6 - neg;

    // Normalize each 1..5 to 0..100
    const to100 = (x) => ((x - 1) / 4) * 100;

    const scores = pos.map(to100);
    scores.push(to100(q6inv));

    // Simple average (you can add weights later)
    const avg = scores.reduce((a,b)=>a+b,0) / scores.length;

    return Math.round(avg);
  }

  // ---------- Storage ----------
  const KEY = "rel_journal_v1";

  function loadAll(){
    try{
      return JSON.parse(localStorage.getItem(KEY)) || [];
    } catch(e){
      return [];
    }
  }

  function saveAll(items){
    localStorage.setItem(KEY, JSON.stringify(items));
  }

  // ---------- UI ----------
  function renderDashboard(items){
    // sort by date desc
    const sorted = [...items].sort((a,b)=> (a.date < b.date ? 1 : -1));
    const history = $("history");
    history.innerHTML = "";

    if(sorted.length === 0){
      $("scoreVal").textContent = "—";
      $("scoreLabel").textContent = "Nu ai încă intrări salvate.";
      $("trendPill").textContent = "0 zile";
      $("barFill").style.width = "0%";
      $("barFill").style.background = "transparent";
      return;
    }

    const latest = sorted[0];
    const latestScore = latest.score;

    $("scoreVal").textContent = latestScore;
    $("scoreLabel").textContent = scoreLabel(latestScore);
    $("trendPill").textContent = `${sorted.length} zile`;
    $("barFill").style.width = `${clamp(latestScore,0,100)}%`;
    $("barFill").style.background = scoreColor(latestScore);

    // show last 10
    sorted.slice(0,10).forEach(it=>{
      const li = document.createElement("li");
      const left = document.createElement("div");
      left.innerHTML = `<div><strong>${it.date}</strong></div><div class="small">${(it.notes||"").slice(0,40)}${(it.notes||"").length>40?"…":""}</div>`;
      const right = document.createElement("div");
      right.innerHTML = `<div style="font-weight:800;color:${scoreColor(it.score)}">${it.score}</div><div class="small">${scoreLabel(it.score)}</div>`;
      li.appendChild(left);
      li.appendChild(right);
      history.appendChild(li);
    });
  }

  function setTodayIfEmpty(){
    if(!$("date").value){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      $("date").value = `${yyyy}-${mm}-${dd}`;
    }
  }

  // ---------- Init ----------
  ["q1","q2","q3","q4","q5","q6"].forEach(id => rangeOptions($(id)));
  setTodayIfEmpty();
  renderDashboard(loadAll());

  // ---------- Events ----------
  $("saveBtn").addEventListener("click", () => {
    const entry = {
      date: $("date").value,
      q1: Number($("q1").value),
      q2: Number($("q2").value),
      q3: Number($("q3").value),
      q4: Number($("q4").value),
      q5: Number($("q5").value),
      q6: Number($("q6").value),
      notes: $("notes").value.trim()
    };

    if(!entry.date){
      $("msg").textContent = "Te rog selectează o dată.";
      $("msg").className = "small danger";
      return;
    }

    entry.score = computeScore(entry);

    const items = loadAll();
    // replace if same date exists
    const idx = items.findIndex(x => x.date === entry.date);
    if(idx >= 0) items[idx] = entry;
    else items.push(entry);

    saveAll(items);
    renderDashboard(items);

    $("msg").textContent = `Salvat. Scor: ${entry.score}/100`;
    $("msg").className = "small";
  });

  $("clearBtn").addEventListener("click", () => {
    localStorage.removeItem(KEY);
    $("notes").value = "";
    ["q1","q2","q3","q4","q5","q6"].forEach(id => $(id).value = 3);
    renderDashboard([]);
    $("msg").textContent = "Toate datele au fost șterse din acest browser.";
    $("msg").className = "small";
  });
</script>
</body>
</html>
